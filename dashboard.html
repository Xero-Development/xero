<!DOCTYPE html>
<html lang="en" class="x-app">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PX-OS | Dashboard</title>
  <link rel="stylesheet" href="./x-layout.css" />
  <link rel="stylesheet" href="./x-components.css" />
  <link rel="stylesheet" href="./x-forms.css" />
  <link rel="stylesheet" href="./x-icons.css" />
  <link rel="stylesheet" href="./x-animations.css" />
  <link rel="stylesheet" href="./x-styles.css" />

  <style>
    .x-os{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 24px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
    }
    .x-os-side{
      position: sticky;
      top: 74px;
      height: calc(100vh - 92px);
      border: 1px solid var(--x-border);
      border-radius: 14px;
      background: var(--x-card);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .x-os-main{
      display: flex;
      flex-direction: column;
      gap: 18px;
      min-width: 0;
    }
    .x-os-view{ display:none; flex-direction: column; gap: 18px; }
    .x-os-view.active{ display:flex; }
    .x-os-side-top{
      padding: 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .x-os-badge{ display:flex; gap:10px; align-items:center; }
    .x-os-dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: var(--x-accent);
      box-shadow: 0 0 0 3px rgba(102,204,255,.12);
    }
    .x-os-title{ font-weight: 950; letter-spacing: .2px; }
    .x-os-mini{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .x-os-clock{ font-size: 1.15rem; font-weight: 950; margin-top: 2px; }
    .x-os-nav{
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }
    .x-os-item{
      text-align: left;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--x-text);
      cursor: pointer;
      font-weight: 850;
    }
    .x-os-item:hover{ background: rgba(255,255,255,.07); }
    .x-os-item.active{
      border-color: rgba(102,204,255,.65);
      background: rgba(102,204,255,.10);
      color: var(--x-accent);
    }
    .x-os-side-bottom{
      padding: 12px;
      border-top: 1px solid rgba(255,255,255,.08);
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .x-os-stat{ display:flex; flex-direction: column; gap: 2px; }
    .x-os-stat-num{ font-size: 1.2rem; font-weight: 950; }
    .x-os-collapse{ padding: 8px 10px; }
    .x-os.collapsed{ grid-template-columns: 86px 1fr; }
    .x-os.collapsed .x-os-title,
    .x-os.collapsed .x-os-mini,
    .x-os.collapsed .x-os-stat,
    .x-os.collapsed .x-os-collapse{ display:none; }
    .x-os.collapsed .x-os-item{ text-align:center; padding: 10px; }
    @media (max-width: 980px){
      .x-os{ grid-template-columns: 1fr; }
      .x-os-side{ position: relative; top: 0; height: auto; }
    }
  </style>
</head>

<body class="x-app">
  <nav class="x-navbar">
    <div class="x-navbar-inner">
      <div class="x-navbar-left">
        <span class="x-navbar-brand">Project X</span>
      </div>
      <div class="x-navbar-center">
        <a class="x-nav-link" href="./index.html">Home</a>
        <a class="x-nav-link" href="./about.html">About</a>
        <a class="x-nav-link" href="./docs.html">Docs</a>
        <a class="x-nav-link" href="./support.html">Support</a>
        <a class="x-nav-link x-accent" href="./apply.html">Apply</a>
      </div>
      <div class="x-navbar-right">
        <button class="x-button x-button-ghost" id="logoutBtn" type="button">Logout</button>
      </div>
    </div>
  </nav>

  <div class="x-os">
    <aside class="x-os-side">
      <div class="x-os-side-top">
        <div class="x-os-badge">
          <div class="x-os-dot"></div>
          <div>
            <div class="x-os-title">PX-OS</div>
            <div class="x-muted x-small">Realtime: <span id="rtStatus">starting…</span></div>
          </div>
        </div>

        <div class="x-os-mini">
          <div class="x-muted x-small">Local time</div>
          <div class="x-os-clock" id="liveClock">--:--:--</div>
        </div>
      </div>

      <nav class="x-os-nav">
        <button class="x-os-item active" data-view="view-overview">Overview</button>
        <button class="x-os-item" data-view="view-live">OS Live</button>
        <button class="x-os-item" data-view="view-apps">Applications</button>
        <button class="x-os-item" data-view="view-profile">Profile</button>
      </nav>

      <div class="x-os-side-bottom">
        <div class="x-os-stat">
          <div class="x-muted x-small">Online</div>
          <div class="x-os-stat-num"><span id="onlineCount">0</span></div>
        </div>

        <button class="x-button x-button-ghost x-os-collapse" id="collapseSide" type="button">Collapse</button>
      </div>
    </aside>

    <main class="x-os-main">
      <section class="x-os-view active" id="view-overview">
        <section class="x-card">
          <h1>Dashboard</h1>
          <p class="x-muted">Live status, presence, and your account. Also your local agent stats (if the browser allows it).</p>
        </section>

        <section class="x-card">
          <h2>OS Status</h2>
          <p class="x-muted">Source: <code>localhost:17361/v1/stats</code></p>

          <div class="x-status-grid">
            <div class="x-status-item"><div class="x-muted x-small">Platform</div><div id="osPlatform" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Release</div><div id="osRelease" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Arch</div><div id="osArch" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Hostname</div><div id="osHostname" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Uptime</div><div id="osUptime" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Load Avg</div><div id="osLoadavg" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Cores</div><div id="osCores" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">CPU Model</div><div id="osCpuModel" class="x-status-val">--</div></div>

            <div class="x-status-item"><div class="x-muted x-small">Memory Total</div><div id="memTotal" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Memory Free</div><div id="memFree" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Process RSS</div><div id="procRss" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Heap Used</div><div id="procHeapUsed" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Heap Total</div><div id="procHeapTotal" class="x-status-val">--</div></div>

            <div class="x-status-item"><div class="x-muted x-small">Process CPU</div><div id="procCpu" class="x-status-val">--</div></div>
            <div class="x-status-item"><div class="x-muted x-small">Stats API</div><div id="statsApi" class="x-status-val">--</div></div>
          </div>

          <details style="margin-top:12px;">
            <summary class="x-muted">Raw JSON</summary>
            <pre id="statsRaw" class="x-muted" style="white-space:pre-wrap;margin:10px 0 0;">--</pre>
          </details>
        </section>
      </section>

      <section class="x-os-view" id="view-live">
        <section class="x-card">
          <h2>Online Users</h2>
          <ul id="onlineList" class="x-list" style="margin-top:10px;"></ul>
        </section>
        <section class="x-card">
          <h2>Realtime Feed</h2>
          <p class="x-muted">Live updates from the database (your applications only).</p>
          <ul id="appFeed" class="x-list" style="margin-top:10px;"></ul>
        </section>
      </section>

      <section class="x-os-view" id="view-apps">
        <section class="x-card">
          <h2>Your Applications</h2>
          <p class="x-muted">This updates live when your application changes.</p>
          <ul id="appFeed2" class="x-list" style="margin-top:10px;"></ul>
        </section>
      </section>

      <section class="x-os-view" id="view-profile">
        <section class="x-card" id="userCard">
          <h2>Account</h2>
          <p class="x-muted" id="profileLine">Loading user…</p>

          <div class="x-row" style="margin-top:12px;">
            <button class="x-button x-button-ghost" id="editProfileBtn" type="button">Edit Profile</button>
          </div>

          <div id="editProfileSection" style="display:none; margin-top:14px;">
            <form id="editProfileForm" class="x-form">
              <label class="x-label">Username
                <input class="x-input" id="editUsername" type="text" placeholder="New username" required />
              </label>

              <div class="x-row">
                <button class="x-button" type="submit">Save</button>
                <button class="x-button x-button-ghost" id="cancelEditBtn" type="button">Cancel</button>
              </div>

              <p class="x-muted" id="editStatus" style="margin-top:10px;"></p>
            </form>
          </div>
        </section>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabase-client.js"></script>
  <script src="./dashboard.js" defer></script>
</body>
</html>
